 
FOD
===


When using `track <../commands/track.html>`__ Trekker requires an fiber orientation distribution (FOD) image to be specified.

.. Tip::

    - Trekker supports both symmetric and asymmetric FODs that can be represented with even or odd ordered spherical harmonics.
    - FODs generated by other dMRI tools, such as `MRtrix3 <https://mrtrix.readthedocs.io>`__ and `ExploreDTI <https://www.exploredti.com/>`__, are compatible with Trekker. (When using **track** with ExploreDTI generated FODs, make sure to use the correct **--orderOfDirections**!)

There are two ways to provide the FOD:

**1.** as spherical harmonic coefficients

The FOD image stores each coefficient as a separate volume with respect to spherical harmonic degree, l and m, as shown in the tables below. Based on the number of volumes in the image, trekker automatically identifies if the FOD is symmetric or asymmetric.

.. table:: For symmetric FOD

	+---+------+------+------+------+------+------+------+------+------+-----+
	|   | vol1 | vol2 | vol3 | vol4 | vol5 | vol6 | vol7 | vol8 | vol9 | ... |
	+---+------+------+------+------+------+------+------+------+------+-----+
	| l | 0    | 2    | 2    | 2    | 2    | 2    | 4    | 4    | 4    | ... |
	+---+------+------+------+------+------+------+------+------+------+-----+
	| m | 0    | -2   | -1   | 0    | 1    | 2    | -4   | -3   | -2   | ... |
	+---+------+------+------+------+------+------+------+------+------+-----+


.. table:: For asymmetric FOD

	+---+------+------+------+------+------+------+------+------+------+-----+
	|   | vol1 | vol2 | vol3 | vol4 | vol5 | vol6 | vol7 | vol8 | vol9 | ... |
	+---+------+------+------+------+------+------+------+------+------+-----+
	| l | 0    | 1    | 1    | 1    | 2    | 2    | 2    | 2    | 2    | ... |
	+---+------+------+------+------+------+------+------+------+------+-----+
	| m | 0    | -1   | 0    | 1    | -2   | -1   | 0    | 1    | 2    | ... |
	+---+------+------+------+------+------+------+------+------+------+-----+

**2.** as a spherical function defined on provided vertices of a sphere

In this case, FOD image stores a spherical function at each voxel. Volume *n* of the FOD image corresponds to the value of the spherical function at the coordinates provided in line *n* of the vertices of the sphere that should be provided after the image. Additionally user should specify if the function is symmetric or asymmetric.

.. code-block:: bash

    # Example
    ./trekker track \
        FOD_spherical_function_values.nii.gz FOD_spherical_function_domain.txt asym \
        --seed SEED.nii.gz \
        --seed_count 10000 \
        --output OUTPUT.vtk

|

**Changing the order of directions**

Trekker's **track** allows for flipping and reordering of the FOD order of directions using the *-orderOfDirections* option.

**-orderOfDirections <one of the 48 direction options>** Switches direction of FOD. By default XYZ is assumed (no change). A lower case can be used to switch the direction, e.g., xYZ switches the sign of the first component. The order of components can be changed as well, e.g., yXz switches the sign of the second component while replacing it with the first, at the same time the sign of the last component is also changed.

.. code-block:: bash

    # Example
    ./trekker track \
        FOD.nii.gz \
        --orderOfDirections Zyx \
        --seed SEED.nii.gz \
        --seed_count 10000 \
        --output OUTPUT.vtk
